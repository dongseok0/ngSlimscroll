angular.module("jkuri.slimscroll",[]).directive("ngSlimscroll",["$document","$window","$compile",function(e,t,o){"use strict";var n=function(e,t,o){var n=void 0;n=0!==o.height&&void 0!==o.height?o.height:0!==t[0].clientHeight?t[0].clientHeight:250,e.width=o.width||t[0].clientWidth||"auto",e.height=n,e.size=o.size||"7px",e.color=o.color||"#000",e.position=o.position||"right",e.distance=o.distance||"1px",e.borderRadius=o.borderRadius||"3px",e.start=o.start||"top",e.alwaysVisible=e.$eval(o.alwaysVisible)===!1?!1:!0,e.barDraggable=e.$eval(o.barDraggable)===!1?!1:!0,e.wheelStep=o.wheelStep||20,e.opacity=o.opacity||.5,e.enabled=e.$eval(o.enabled)===!1?!1:!0,e.horizontalScroll=e.$eval(o.horizontalScroll)||!1,e.horizontalScrollPosition=o.horizontalScrollPosition||"bottom",e.touchScrollStep=o.touchScrollStep||200,e.watchContent=e.$eval(o.watchContent)||!1};return{restrict:"A",scope:!0,link:function(i,a,l){n(i,a,l);var s,r=a[0],c=30,h=!1,d=30;a.css({overflow:"hidden",width:i.width,height:i.height}),i.count=0;var u=angular.element("<div></div>");if(u.css({position:"relative",overflow:"hidden",width:i.width,height:i.height}),i.horizontalScroll){var f=angular.element('<div ng-mousedown="makeBarDraggableHorizontal($event)"></div>');f.css({background:i.color,height:i.size,position:"absolute",left:"0",opacity:i.opacity,display:i.alwaysVisible?"block":"none","border-radius":i.borderRadius,"z-index":"99",cursor:"pointer"});var p="bottom"===i.horizontalScrollPosition?{bottom:i.distance}:{top:i.distance};f.css(p)}else{var f=angular.element('<div ng-mousedown="makeBarDraggable($event)""></div>');f.css({background:i.color,width:i.size,position:"absolute",top:"0",opacity:i.opacity,display:i.alwaysVisible?"block":"none","border-radius":i.borderRadius,"z-index":"99",cursor:"pointer"});var p="right"===i.position?{right:i.distance}:{left:i.distance};f.css(p)}if(a.wrap(u),a.append(f),o(f)(i),a.on("mouseenter",function(){i.horizontalScroll?i.getBarWidth():i.getBarHeight()}),a.on("mouseleave",function(){i.alwaysVisible||f.css({display:"none"})}),i.makeBarDraggable=function(){f.bind("mousedown",function(t){var o=parseFloat(f.css("top")),n=t.pageY,a=!0;e.bind("mousemove",function(e){f.css({top:o+e.pageY-n+"px"}),i.scrollContent(0,f[0].offsetTop,!1)}),e.bind("mouseup",function(t){a=!1,e.unbind("mousemove")})}).bind("selectstart",function(e){return e.preventDefault(),e.stopPropagation(),!1})},i.makeBarDraggableHorizontal=function(){f.bind("mousedown",function(t){var o=parseFloat(f.css("left")),n=t.pageX,a=!0;e.bind("mousemove",function(e){f.css({left:o+e.pageX-n+"px"}),i.scrollContentHorizontal(0,f[0].offsetLeft,!1)}),e.bind("mouseup",function(t){a=!1,e.unbind("mousemove")})}).bind("selectstart",function(e){return e.preventDefault(),e.stopPropagation(),!1})},i.getBarHeight=function(){var e=Math.max(r.offsetHeight/r.scrollHeight*r.offsetHeight,c);f.css({height:e+"px"});var t=e===r.offsetHeight?"none":"block";f.css({display:t})},i.getBarWidth=function(){var e=Math.max(r.offsetWidth/r.scrollWidth*r.offsetWidth,d);f.css({width:e+"px"});var t=e===r.offsetWidth?"none":"block";f.css({display:t})},i.attachWheel=function(o){t.addEventListener?(o.addEventListener("DOMMouseScroll",i.onWheel,!1),o.addEventListener("mousewheel",i.onWheel,!1)):e.addEventListener("onmousewheel",i.onWheel)},i.detachWheel=function(o){t.removeEventListener?(o.removeEventListener("DOMMouseScroll",i.onWheel,!1),o.removeEventListener("mousewheel",i.onWheel,!1)):e.removeEventListener("onmousewheel",i.wheel)},i.onWheel=function(e){var e=e||t.event,o=0;e.wheelDelta&&(o=-e.wheelDelta/120),e.detail&&(o=e.detail/3);e.target||e.srcTarget||e.srcElement;i.horizontalScroll?i.scrollContentHorizontal(o,!0):i.scrollContent(o,!0),e.preventDefault&&!h&&e.preventDefault(),h||(e.returnValue=!1)},i.scrollContent=function(e,t,o){h=!1;var n,a=e,l=r.offsetHeight-f[0].offsetHeight;t&&(a=parseInt(f.css("top"),10)+e*parseInt(i.wheelStep,10)/100*f[0].offsetHeight,a=Math.min(Math.max(a,0),l),a=e>0?Math.ceil(a):Math.floor(a),f.css({top:a+"px"})),n=parseInt(f.css("top"),10)/(r.offsetHeight-f[0].offsetHeight),a=n*(r.scrollHeight-r.offsetHeight),r.scrollTop=a},i.scrollContentHorizontal=function(e,t,o){h=!1;var n,a=e,l=r.offsetWidth-f[0].offsetWidth;t&&(a=parseInt(f.css("left"),10)+e*parseInt(i.wheelStep,10)/100*f[0].offsetWidth,a=Math.min(Math.max(a,0),l),a=e>0?Math.ceil(a):Math.floor(a),f.css({left:a+"px"})),n=parseInt(f.css("left"),10)/(r.offsetWidth-f[0].offsetWidth),a=n*(r.scrollWidth-r.offsetWidth),r.scrollLeft=a},a.bind("touchstart",function(e,t){e.touches.length&&(s=e.touches[0].pageY)}),a.bind("touchmove",function(e){if(h||e.preventDefault(),e.touches.length){var t=(s-e.touches[0].pageY)/i.touchScrollStep;i.horizontalScroll?i.scrollContentHorizontal(t,!0):i.scrollContent(t,!0),s=e.touches[0].pageY}}),l.$observe("enabled",function(){i.enabled=i.$eval(l.enabled),i.enabled===!1?(f.remove(),i.detachWheel(r)):(a.append(f),i.attachWheel(r))}),i.watchContent){var g=i.$watch(function(){return a.html()},function(){i.init()});i.$on("$destroy",function(){g()})}i.init=function(){return f.css("top","0"),i.horizontalScroll?(i.getBarWidth(),i.makeBarDraggableHorizontal()):(i.getBarHeight(),i.makeBarDraggable()),i.alwaysVisible||f.css({display:"none"}),i.attachWheel(r),!0},i.init()}}}]);
